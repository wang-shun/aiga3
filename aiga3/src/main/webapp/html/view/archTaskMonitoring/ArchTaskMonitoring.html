
<style type="text/css">
    #condition,#secondLevelCondition,#thirdLevelCondition{
        width: 230px;
        padding:5px 0px;
        height: 30px;
        border:0.8px solid rgb(210, 214, 222);
        font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "STHeitiSC-Light", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
        font-style: normal;
        font-size: 12px;
        color: rgb(120, 120, 120);
    }
    .text-style{
        color: red;
    }
</style>
<div class="row" id="Page_taskMonitoring">
    <div class="col-md-12">
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#dataSelectByView" role="tab" data-toggle="tab">视图信息查询</a></li>
                <li role="presentation"><a href="#dataSelectByTable" role="tab" data-toggle="tab">表格信息查询</a></li>
                <li role="presentation"><a href="#dataSelectByTop" role="tab" data-toggle="tab">Top10</a></li>
            </ul>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="dataSelectByView">
                    <div class="box">
                        <form id="JS_queryDataForm">
                            <div class="box-tools pull-right">
                            </div>
                            <div class="box-body"><br/>
                                <div class ="row">
                                    <div class="form-group col-sm-6">
                                        <label class="col-sm-2  control-label" style="margin-top: 5px">查询时间:</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control input-sm " name="startDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="text-center">
                                        <button type="reset" class="btn btn-default">重置</button>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" name="query">查询</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="box" id="JS_text" style="min-height:100px;border:1px solid green;">
                        <div class="box-header with-border">
                            <h3 class="box-title"><span name="timeShow"></span>信息汇总报告:</h3>
                        </div>
                        <div class="box-body">
                            <div class="row" id="JS_archTaskInfoShowText">
                                <!--报告1-->
                            </div>
                            <div class="row" id="JS_archTaskInfoShowTextSecond">
                                <!--报告2-->
                            </div>
                        </div>
                    </div>
                    <div class="box" id="JS_taskMonitoringList" style="min-height:100px;">
                        <div class="box-header" id="JS_monitorInfoViewFirst">
                        </div>
                        <div class="box-body">
                            <div  id="JS_tableFirstHint"></div>
                            <div id="taskSumAndSuccessful" style="width: 1000px;height:400px;margin: auto;position: relative;left: 0;right: 0;"></div>
                        </div>
                    </div>
                    <div class="box" id="JS_taskMonitoringListByTime" style="min-height:100px;">
                        <div class="box-header " id="JS_monitorInfoViewSecond">
                        </div>
                        <div class="box-body">
                            <div id="JS_tableSecondHint"> </div>
                            <!--<div id="taskRuntimeByTime" style="width: 1000px;height:400px;margin: auto;float:left;position: relative;left: 100px;right: 0;"></div>-->
                            <div id="taskRuntimeByTime" style="width: 1000px;height:400px;margin-top: 30px;position: absolute;left: 50%;top: 50%;transform: translate(-50%,-50%)"></div>
                            <div id="JS_tableSecondHintButton"></div>
                        </div>
                    </div>
                    <div class="box" id="JS_taskMonitoringFrequencyAndTimes" style="min-height:100px;">
                        <div class="box-header" id="JS_monitorInfoViewThird">
                        </div>
                        <div class="box-body">
                            <div  id="JS_tableThirdHint"></div>
                            <div style="width: 1000px;height: 400px;margin: auto;position: relative;left: 0;right: 0;">
                                <div id="taskRuntimeByFrequency" style="width: 500px;height:400px;margin:auto;float: left"></div>
                                <div id="taskRuntimeByTimes" style="width: 500px;height:400px;margin: auto;float: left;"></div>
                            </div>

                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="dataSelectByTable">
                    <div class="box" >
                        <form id="JS_queryDataFormTable">
                            <div class="box-body"><br/>
                                <div class ="row">
                                    <div class="form-group col-sm-4" style="float: left">
                                        <label class="col-sm-2" style="margin-top: 5px">查询时间:</label>
                                        <div class="col-sm-2">
                                            <input type="text" style="width: 200px;" class="form-control input-sm " name="startDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-4" >
                                        <label class="col-sm-2  control-label" style="margin-top: 5px">一级查询:</label>
                                        <div class="col-sm-2">
                                            <select class="selectpicker" name="condition" id="condition" data-live-search="true" title="请选择">
                                                <option value="failTaskList">表一、一周内失败任务信息清单</option>
                                                <option value="taskRunningFrequency">表二、一天内任务运行频率情况信息</option>
                                                <option value="taskRunInTime">表三、一天中任务指定时长内任务运行信息</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-4" id="secondLevelSelect">
                                        <!--二级下拉框-->
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="text-center">
                                        <button type="reset" class="btn btn-default" name="resetSelect">重置</button>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" name="query">查询</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="box" id="JS_taskMonitoringListTable" style="width:auto;height:auto;">
                    <div class="box-header with-border">
                        <div class="box-tools pull-right" style="margin-bottom: 10px">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse" data-target="#firstTable"><i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body" id="firstTable" style="overflow: auto;height:360px">
                        <table class="table table-bordered table-hover" id="dataMaintainListTable">
                            <tbody name="content"></tbody>
                        </table>
                    </div>
                    <div class="box-footer no-border">
                        <div class="dataTables_paginate" name="pagination" style="text-align:center"></div>
                    </div>
                </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="dataSelectByTop">
                    <div class="box">
                        <form id="JS_queryDataFormTop">
                            <div class="box-tools pull-right">
                            </div>
                            <div class="box-body"><br/>
                                <div class ="row">
                                    <div class="form-group col-sm-6">
                                        <label class="col-sm-2  control-label" style="margin-top: 5px">查询时间:</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control input-sm " name="startDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="text-center">
                                        <button type="reset" class="btn btn-default">重置</button>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" name="query">查询</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="box" id="JS_taskMonitoringListTopFirst" style="width: 33%;height:350px;float: left;">
                        <div style="text-align: center;">一周内任务失败次数Top10</div>
                        <div class="box-body" >
                            <table class="table table-bordered table-hover" id="TopTableFirst">
                                <thead>
                                <tr>
                                    <th style="text-align:center">cfg_task_id</th>
                                    <th style="text-align:center">task_name</th>
                                    <th style="text-align:center">失败次数</th>
                                </tr>
                                </thead>
                                <tbody name="content"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box" id="JS_taskMonitoringListTopSecond" style="width: 33%;height:350px;float:left;">
                        <div style=";text-align: center;">一周内任务执行失败率Top10</div>
                        <div class="box-body" >
                            <table class="table table-bordered table-hover" id="TopTableSecond">
                                <thead>
                                <tr>
                                    <th style="text-align:center">cfg_task_id</th>
                                    <th style="text-align:center">task_name</th>
                                    <th style="text-align:center">失败率</th>
                                </tr>
                                </thead>
                                <tbody name="content"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box" id="JS_taskMonitoringListTopThird" style="width: 33%;height:350px;float:left;">
                        <div style=";text-align: center;"></div>
                        <div class="box-body" >
                            <!--<table class="table table-bordered table-hover" id="TopTableThird">-->
                                <!--<thead>-->
                                <!--<tr>-->
                                    <!--<th style="text-align:center"></th>-->
                                    <!--<th style="text-align:center"></th>-->
                                    <!--<th style="text-align:center"></th>-->
                                <!--</tr>-->
                                <!--</thead>-->
                                <!--<tbody name="content"></tbody>-->
                            <!--</table>-->
                        </div>
                    </div>
                </div>
            </div>
    </div>
</div>

<script id="TPL_getReportText" type="text/x-handlebars-template">
        <p style="text-indent:2em;margin-top:13px;">昨天任务总配置数为<span class="text-style">{{lastdayTaskCount}}</span>个，今天新增配置任务<span class="text-style">{{lastdayAddTaskCount}}</span>个;任务总执行次数为<span class="text-style">{{allTaskCount}}</span>次，相比前一天变化<span class="text-style">{{countChange}}</span>次;任务执行成功率为<span class="text-style">{{taskSuccessRate}}</span>%,相比前一天变化<span class="text-style">{{taskSuccessRateChange}}</span>%;任务执行平均时长为<span class="text-style">{{taskAvgTime}}</span>分钟,相比前一天变化<span class="text-style">{{taskAvgTimeChange}}</span>分钟;</p>
</script>
<script id="TPL_getReportTextSecond" type="text/x-handlebars-template">
        <p style="text-indent:2em;margin-top:13px;">今天截止时间<span class="text-style">{{sysDate}}</span>，任务已执行<span class="text-style">{{taskOverCount}}</span>个，其中执行失败任务<span class="text-style">{{failTaskCount}}</span>次，涉及<span class="text-style">{{taskConnectCount}}</span>个任务，平均执行时间超过15分钟的有<span class="text-style">{{taskMoreAvgCount}}</span>条任务。任务执行失败详细清单和执行时长超长的任务清单可查看表一和表三；</p>
</script>
 <script id="TPL_getFullTableList" type="text/x-handlebars-template">

     <tr>
         <th colspan="1" style="text-align: left;color:rgb(84,84,51)">监控信息表格一</th>
         <th colspan="5" style="text-align: center;color:rgb(84,84,51)">一周内失败任务信息清单</th>
     </tr>
     <tr>
         <th style="width:110px"></th>
         <th style="text-align:center">start_date</th>
         <th style="text-align:center">cfg_task_id</th>
         <th style="text-align:center">task_name</th>
         <th style="text-align:center">business_class</th>
         <th style="text-align:center">results</th>
     </tr>
     {{#each this}}
     <tr style="text-align: center">
         <td><input type="radio" class="minimal" value="{{idThird}}" name="idThird"></td>
         <td>{{startTime}}</td>
         <td>{{cfgTaskId}}</td>
         <td>{{taskName}}</td>
         <td>{{businessClass}}</td>
         <td>{{results}}</td>
     </tr>
     {{/each}}
 </script>
 <script id="TPL_getFullTableListSecond" type="text/x-handlebars-template">
     <tr>
         <th colspan="1" style="text-align:left;color:rgb(84,84,51)">监控信息表格二</th>
         <th colspan="6" style="text-align:center;color: rgb(84,84,51)">一天内任务运行频率情况信息</th>
     </tr>
     <tr>
        <th style="width:110px"></th>
        <th style="text-align:center">成功运行次数</th>
        <th style="text-align:center">失败运行次数</th>
        <th style="text-align:center">cfg_task_id</th>
        <th style="text-align:center">task_name</th>
        <th style="text-align:center">business_class</th>
        <th style="text-align:center">成功率</th>
     </tr>
     {{#each this}}
     <tr style="text-align: center">
         <td><input type="radio" class="minimal" value="{{idThird}}" name="idThird"></td>
         <td>{{successTimes}}</td>
         <td>{{failTimes}}</td>
         <td>{{cfgTaskId}}</td>
         <td>{{taskName}}</td>
         <td>{{businessClass}}</td>
         <td>{{successRate}}%</td>
     </tr>
     {{/each}}
 </script>
<script id="TPL_getFullTableListThird" type="text/x-handlebars-template">
    <tr>
        <th colspan="1" style="text-align: left;color:rgb(84,84,51)">监控信息表格三</th>
        <th colspan="4" style="text-align: center;color:rgb(84,84,51)">一天中任务指定时长内任务运行信息</th>
    </tr>
    <tr>
        <th style="width:110px"></th>
        <th style="text-align:center">cfg_task_id</th>
        <th style="text-align:center">task_name</th>
        <th style="text-align:center">运行平均时长(分钟)</th>
        <th style="text-align:center">task_expr</th>
    </tr>
    {{#each this}}
    <tr style="text-align: center">
        <td><input type="radio" class="minimal" value="{{idThird}}" name="idThird"></td>
        <td>{{cfgTaskId}}</td>
        <td>{{taskName}}</td>
        <td>{{avgTime}}</td>
        <td>{{taskExpr}}</td>
    </tr>
    {{/each}}
</script>
<script id="TPL_getFullTableListTimes" type="text/x-handlebars-template">
    <tr>
        <th colspan="1" style="text-align: left;color:rgb(84,84,51)">监控信息表格三(二级查询)</th>
        <th colspan="4" style="text-align: center;color:rgb(84,84,51)">一天内任务运行频率分布情况</th>
    </tr>
    <tr>
        <th style="width:110px"></th>
        <th style="text-align:center">cfg_task_id</th>
        <th style="text-align:center">task_name</th>
        <th style="text-align:center">cfg_task_type_code</th>
        <th style="text-align:center">business_class</th>
    </tr>
    {{#each this}}
    <tr style="text-align: center">
        <td><input type="radio" class="minimal" value="{{idThird}}" name="idThird"></td>
        <td>{{cfgTaskId}}</td>
        <td>{{taskName}}</td>
        <td>{{cfgTaskTypeCode}}</td>
        <td>{{businessClass}}</td>
    </tr>
    {{/each}}
</script>
<script id="TPL_getFullTableListMinutes" type="text/x-handlebars-template">
    <tr>
        <th colspan="1" style="text-align: left;color:rgb(84,84,51)">监控信息表格三(二级查询)</th>
        <th colspan="4" style="text-align: center;color:rgb(84,84,51)">一天内任务执行平均时长区间分布数量</th>
    </tr>
    <tr>
        <th style="width:110px"></th>
        <th style="text-align:center">cfg_task_id</th>
        <th style="text-align:center">task_name</th>
        <th style="text-align:center">avg_time</th>
        <th style="text-align:center">task_expr</th>
    </tr>
    {{#each this}}
    <tr style="text-align: center">
        <td><input type="radio" class="minimal" value="{{idThird}}" name="idThird"></td>
        <td>{{cfgTaskId}}</td>
        <td>{{taskName}}</td>
        <td>{{avgTime}}</td>
        <td>{{taskExpr}}</td>
    </tr>
    {{/each}}
</script>
<script id="TPL_getTopTableFirst" type="text/x-handlebars-template">
    {{#each this}}
    <tr style="text-align: center">
        <td>{{cfgTaskId}}</td>
        <td>{{taskName}}</td>
        <td>{{countSum}}</td>
    </tr>
    {{/each}}
</script>
<script id="TPL_getTopTableSecond" type="text/x-handlebars-template">
    {{#each this}}
    <tr style="text-align: center">
        <td>{{cfgTaskId}}</td>
        <td>{{taskName}}</td>
        <td>{{failRate}}%</td>
    </tr>
    {{/each}}
</script>


<script type="text/javascript">
seajs.use("script/archTaskMonitoring/ArchTaskMonitoring", function(init) {
    init.init();
});
</script>


